<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‹åŠ›é¢è¯• - PUA CLI</title>
  <meta name="description" content="å‹åŠ›é¢è¯•æ¨¡æ‹Ÿå™¨ - é¢å¯¹åˆé’»é¢è¯•å®˜çš„è¿ç¯è¿½é—®ï¼ŒåšæŒ10è½®æ‹¿åˆ°Offer">
  <meta property="og:title" content="å‹åŠ›é¢è¯• - PUA CLI">
  <meta property="og:description" content="å‹åŠ›é¢è¯•æ¨¡æ‹Ÿå™¨ - 10è½®é—®ç­”åˆ¶ï¼ŒæŒºä½å‹åŠ›æ‹¿åˆ°Offer">
  <meta name="theme-color" content="#0a0a0a">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¯</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: #0a0a0a;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .terminal {
      width: 90%; max-width: 900px; margin: 40px auto;
      background: #0a0a0a; border: 1px solid #333; border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      display: flex; flex-direction: column;
      height: calc(100vh - 80px); overflow: hidden;
    }

    .terminal-header {
      padding: 10px 16px; background: #1a1a1a;
      display: flex; align-items: center; gap: 8px;
      border-bottom: 1px solid #333;
    }

    .terminal-buttons { display: flex; gap: 8px; }
    .terminal-btn { width: 12px; height: 12px; border-radius: 50%; }
    .terminal-btn.close { background: #ff5f56; }
    .terminal-btn.minimize { background: #ffbd2e; }
    .terminal-btn.maximize { background: #27ca3f; }

    .terminal-title { color: #888; font-size: 12px; flex: 1; text-align: center; }

    .terminal-body {
      flex: 1; padding: 20px; overflow-y: auto; overflow-x: hidden;
      background: #0a0a0a; scroll-behavior: smooth; min-height: 0;
    }

    .terminal-body::-webkit-scrollbar { width: 8px; }
    .terminal-body::-webkit-scrollbar-track { background: #0a0a0a; }
    .terminal-body::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

    /* â”€â”€â”€ Setup View â”€â”€â”€ */
    .setup-view { animation: fadeIn 0.3s ease-out; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }

    .setup-title {
      font-size: 22px; font-weight: 700; margin-bottom: 6px;
      background: linear-gradient(90deg, #ff4444, #ff8800);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    .setup-subtitle { color: #666; font-size: 12px; margin-bottom: 24px; }

    .setup-section { margin-bottom: 20px; }
    .setup-label { color: #888; font-size: 12px; margin-bottom: 10px; }

    /* Position cards */
    .position-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
    }

    .position-card {
      background: #111; border: 1px solid #333; border-radius: 8px;
      padding: 14px; cursor: pointer; transition: all 0.2s;
      position: relative;
    }

    .position-card:hover {
      border-color: #ff6644; background: #1a1111;
      box-shadow: 0 0 20px rgba(255,68,68,0.1);
    }

    .position-card.selected {
      border-color: #ff4444; background: #1a1111;
      box-shadow: 0 0 20px rgba(255,68,68,0.15);
    }

    .position-card.selected::after {
      content: 'âœ“'; position: absolute; top: 8px; right: 10px;
      color: #ff4444; font-size: 14px; font-weight: 700;
    }

    .position-card .emoji { font-size: 20px; margin-bottom: 4px; }
    .position-card .name { color: #ddd; font-size: 13px; font-weight: 500; }
    .position-card .desc { color: #666; font-size: 10px; margin-top: 4px; }

    /* Interviewer cards */
    .interviewer-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
    }

    .interviewer-card {
      background: #111; border: 1px solid #333; border-radius: 8px;
      padding: 12px; cursor: pointer; transition: all 0.2s;
      position: relative;
    }

    .interviewer-card:hover { border-color: #ff6644; }

    .interviewer-card.selected {
      border-color: #ff4444; background: #1a1111;
    }

    .interviewer-card.selected::after {
      content: 'âœ“'; position: absolute; top: 8px; right: 10px;
      color: #ff4444; font-size: 14px; font-weight: 700;
    }

    .interviewer-card .emoji { font-size: 18px; }
    .interviewer-card .name { color: #ddd; font-size: 12px; font-weight: 500; }
    .interviewer-card .title { color: #888; font-size: 10px; }
    .interviewer-card .tag { color: #666; font-size: 9px; margin-top: 4px; }

    /* Severity slider */
    .severity-options { display: flex; gap: 10px; }

    .severity-btn {
      flex: 1; background: #111; border: 1px solid #333; border-radius: 8px;
      padding: 10px; cursor: pointer; transition: all 0.2s;
      text-align: center; font-family: inherit; font-size: 11px; color: #888;
    }

    .severity-btn:hover { border-color: #ff6644; color: #ddd; }
    .severity-btn.selected { border-color: #ff4444; background: #1a1111; color: #ff6644; }

    /* Start button */
    .start-btn {
      width: 100%; padding: 14px; margin-top: 16px;
      background: linear-gradient(135deg, #cc0000, #ff4444);
      border: none; border-radius: 8px; color: white;
      font-family: inherit; font-size: 15px; font-weight: 700;
      cursor: pointer; transition: all 0.2s;
    }

    .start-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(255,68,68,0.3); }
    .start-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: none; box-shadow: none; }

    /* â”€â”€â”€ Interview View â”€â”€â”€ */
    .interview-view { display: none; }

    /* Status bars */
    .status-panel {
      background: #111; border: 1px solid #333; border-radius: 8px;
      padding: 12px 16px; margin-bottom: 16px;
    }

    .status-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 10px;
    }

    .status-round { color: #ff4444; font-size: 14px; font-weight: 700; }
    .status-timer { color: #666; font-size: 11px; }

    .meter { margin-bottom: 8px; }
    .meter-label { display: flex; justify-content: space-between; margin-bottom: 4px; }
    .meter-name { color: #888; font-size: 11px; }
    .meter-value { font-size: 11px; font-weight: 700; }
    .meter-value.stress { color: #ff4444; }
    .meter-value.confidence { color: #44ff44; }

    .meter-bar {
      height: 8px; background: #222; border-radius: 4px; overflow: hidden;
    }

    .meter-fill {
      height: 100%; border-radius: 4px; transition: width 0.5s ease-out;
    }

    .meter-fill.stress {
      background: linear-gradient(90deg, #ff8800, #ff0000);
    }

    .meter-fill.confidence {
      background: linear-gradient(90deg, #44ff44, #00cc00);
    }

    /* Interviewer chips */
    .interviewer-chips {
      display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;
    }

    .interviewer-chip {
      display: flex; align-items: center; gap: 4px;
      background: #111; border: 1px solid #333; border-radius: 16px;
      padding: 4px 10px; font-size: 11px; color: #888;
      transition: all 0.3s;
    }

    .interviewer-chip.speaking {
      border-color: #ff4444; color: #ff6644;
      animation: chipPulse 1.5s ease-in-out infinite;
    }

    @keyframes chipPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255,68,68,0); }
      50% { box-shadow: 0 0 8px 2px rgba(255,68,68,0.3); }
    }

    /* Chat messages */
    .chat-area { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; }

    .msg { display: flex; gap: 10px; animation: msgIn 0.3s ease-out; }

    @keyframes msgIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; } }

    .msg-avatar {
      width: 36px; height: 36px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; flex-shrink: 0; background: #1a1a1a;
      border: 1px solid #333;
    }

    .msg-body { flex: 1; max-width: 80%; }

    .msg-name { font-size: 10px; color: #888; margin-bottom: 3px; }

    .msg-bubble {
      padding: 10px 14px; border-radius: 12px; font-size: 13px;
      line-height: 1.6; border-left: 3px solid var(--msg-color, #444);
      background: #111;
    }

    /* Role-specific message colors */
    .msg-techlead .msg-bubble { --msg-color: #4488ff; background: #111122; }
    .msg-boss .msg-bubble { --msg-color: #ff4444; background: #1a1111; }
    .msg-hr .msg-bubble { --msg-color: #cc44cc; background: #1a1122; }
    .msg-pm .msg-bubble { --msg-color: #44cccc; background: #111a1a; }

    .msg-techlead .msg-bubble { color: #aabbff; }
    .msg-boss .msg-bubble { color: #ffaaaa; }
    .msg-hr .msg-bubble { color: #eaaaee; }
    .msg-pm .msg-bubble { color: #aaeeff; }
    .msg-custom .msg-bubble { --msg-color: #ff8844; background: #1a1511; color: #ffcc99; }

    /* User message */
    .msg-user { flex-direction: row-reverse; }
    .msg-user .msg-body { text-align: right; }
    .msg-user .msg-name { text-align: right; }

    .msg-user .msg-bubble {
      --msg-color: #44ff44; background: #112211; color: #aaffaa;
      border-left: none; border-right: 3px solid #44ff44;
    }

    /* Event message */
    .msg-event {
      text-align: center; color: #888; font-size: 11px;
      padding: 6px 0; font-style: italic;
    }

    /* Quality indicator */
    .quality-badge {
      display: inline-block; font-size: 9px; padding: 1px 6px;
      border-radius: 10px; margin-top: 4px;
    }
    .quality-badge.weak { background: #331111; color: #ff6644; }
    .quality-badge.normal { background: #222211; color: #cccc44; }
    .quality-badge.strong { background: #113311; color: #44ff44; }

    /* Loading */
    .typing-indicator {
      display: none; text-align: center; color: #ff6644;
      font-size: 12px; padding: 8px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

    /* â”€â”€â”€ Ending Modal â”€â”€â”€ */
    .ending-overlay {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85); z-index: 100;
      display: none; align-items: center; justify-content: center;
    }

    .ending-overlay.show { display: flex; }

    .ending-card {
      background: #111; border: 2px solid #ff4444; border-radius: 16px;
      padding: 30px 40px; text-align: center; max-width: 420px;
      animation: endingIn 0.5s ease-out;
    }

    @keyframes endingIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    .ending-emoji { font-size: 60px; margin-bottom: 16px; }
    .ending-title { font-size: 22px; font-weight: 700; color: #fff; margin-bottom: 10px; }
    .ending-desc { color: #999; font-size: 13px; line-height: 1.6; margin-bottom: 20px; }

    .ending-stats {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
      margin-bottom: 20px;
    }

    .ending-stat { text-align: center; }
    .ending-stat-value { font-size: 20px; font-weight: 700; }
    .ending-stat-value.stress { color: #ff4444; }
    .ending-stat-value.confidence { color: #44ff44; }
    .ending-stat-value.round { color: #4488ff; }
    .ending-stat-label { color: #666; font-size: 10px; margin-top: 2px; }

    .ending-actions { display: flex; gap: 10px; justify-content: center; }

    .retry-btn {
      padding: 10px 24px; background: #ff4444; border: none; border-radius: 8px;
      color: white; font-family: inherit; font-size: 13px; font-weight: 700;
      cursor: pointer; transition: all 0.2s;
    }

    .retry-btn:hover { background: #ff6644; transform: translateY(-1px); }

    .home-btn {
      padding: 10px 24px; background: #222; border: 1px solid #444; border-radius: 8px;
      color: #888; font-family: inherit; font-size: 13px; cursor: pointer;
      transition: all 0.2s; text-decoration: none;
    }

    .home-btn:hover { border-color: #666; color: #ccc; }

    /* â”€â”€â”€ Input Area â”€â”€â”€ */
    .input-container {
      display: flex; align-items: flex-end; padding: 10px 16px;
      border-top: 1px solid #222; gap: 8px;
    }

    .input-prompt { color: #44ff44; white-space: pre; line-height: 36px; font-size: 13px; }

    .input-field {
      flex: 1; background: transparent; border: none; color: #ffffff;
      font-family: inherit; font-size: 14px; outline: none;
      caret-color: #44ff44; resize: none;
      min-height: 24px; max-height: 120px; overflow-y: auto; line-height: 1.5;
    }

    .input-field::placeholder { color: #555; }

    .send-btn {
      background: #1a0000; border: 1px solid #333; color: #ff4444;
      padding: 6px 14px; cursor: pointer; font-family: inherit; font-size: 14px;
      transition: all 0.2s; min-height: 36px; flex-shrink: 0;
    }

    .send-btn:hover { background: #2a0000; border-color: #ff4444; }
    .send-btn:disabled { opacity: 0.3; cursor: not-allowed; }

    /* â”€â”€â”€ Status Bar â”€â”€â”€ */
    .status-bar {
      background: #1a1a1a; padding: 6px 16px;
      display: flex; justify-content: space-between; align-items: center;
      border-top: 1px solid #333; font-size: 11px;
    }

    .status-bar .left { color: #ff4444; }
    .status-bar .right { color: #666; }
    .status-bar a { color: #00ccff; text-decoration: none; transition: color 0.2s; }
    .status-bar a:hover { color: #00ffff; }
    .status-bar .sep { color: #444; margin: 0 6px; }

    @media (max-width: 600px) {
      .terminal { width: 95%; margin: 10px auto; height: calc(100vh - 20px); }
      .terminal-body { padding: 12px; }
      .position-grid, .interviewer-grid { grid-template-columns: 1fr; }
      .severity-options { flex-direction: column; }
      .ending-card { padding: 20px; margin: 0 16px; }
      .ending-stats { grid-template-columns: repeat(3, 1fr); gap: 8px; }
      .msg-body { max-width: 85%; }
      .status-bar { flex-direction: column; gap: 4px; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="terminal">
    <div class="terminal-header">
      <div class="terminal-buttons">
        <div class="terminal-btn close"></div>
        <div class="terminal-btn minimize"></div>
        <div class="terminal-btn maximize"></div>
      </div>
      <div class="terminal-title">å‹åŠ›é¢è¯• â€” pua-cli</div>
    </div>

    <div class="terminal-body" id="terminalBody">
      <!-- â•â•â• Setup View â•â•â• -->
      <div class="setup-view" id="setupView">
        <div class="setup-title">ğŸ¯ å‹åŠ›é¢è¯•</div>
        <div class="setup-subtitle">é¢å¯¹åˆé’»é¢è¯•å®˜çš„è¿ç¯è¿½é—®ï¼ŒåšæŒ 10 è½®æ‹¿åˆ° Offerï¼</div>

        <!-- Position Selection -->
        <div class="setup-section">
          <div class="setup-label">é€‰æ‹©é¢è¯•å²—ä½</div>
          <div class="position-grid" id="positionGrid">
            <div class="position-card" data-position="frontend">
              <div class="emoji">ğŸ’»</div>
              <div class="name">å‰ç«¯å¼€å‘</div>
              <div class="desc">React/Vueã€CSSã€æ€§èƒ½ä¼˜åŒ–</div>
            </div>
            <div class="position-card" data-position="backend">
              <div class="emoji">âš™ï¸</div>
              <div class="name">åç«¯å¼€å‘</div>
              <div class="desc">æ•°æ®åº“ã€åˆ†å¸ƒå¼ã€APIè®¾è®¡</div>
            </div>
            <div class="position-card" data-position="product">
              <div class="emoji">ğŸ“‹</div>
              <div class="name">äº§å“ç»ç†</div>
              <div class="desc">éœ€æ±‚åˆ†æã€ç”¨æˆ·ç ”ç©¶ã€å•†ä¸šæ¨¡å¼</div>
            </div>
            <div class="position-card" data-position="design">
              <div class="emoji">ğŸ¨</div>
              <div class="name">UI/UX è®¾è®¡å¸ˆ</div>
              <div class="desc">è®¾è®¡è§„èŒƒã€äº¤äº’é€»è¾‘ã€ç”¨æˆ·ä½“éªŒ</div>
            </div>
          </div>
        </div>

        <!-- Interviewer Selection -->
        <div class="setup-section">
          <div class="setup-label" id="interviewerLabel">é€‰æ‹©é¢è¯•å®˜ï¼ˆå·²é€‰ 0/4ï¼Œè‡³å°‘ 2 äººï¼‰</div>
          <div class="interviewer-grid" id="interviewerGrid">
            <div class="interviewer-card" data-role="techlead">
              <div class="emoji">ğŸ’»</div>
              <div class="name">åˆ˜å“¥ - æŠ€æœ¯æ€»ç›‘</div>
              <div class="tag">è¿½é—®ç»†èŠ‚ / å«Œå¼ƒç®€å†</div>
            </div>
            <div class="interviewer-card" data-role="boss">
              <div class="emoji">ğŸ‘”</div>
              <div class="name">å¼ æ€» - CTO</div>
              <div class="tag">ç”»é¥¼å‹ä»· / è´¨ç–‘èƒ½åŠ›</div>
            </div>
            <div class="interviewer-card" data-role="hr">
              <div class="emoji">ğŸ’¼</div>
              <div class="name">é™ˆå§ - HR æ€»ç›‘</div>
              <div class="tag">å¥—è¯å‹è–ª / é—®æ•æ„Ÿé—®é¢˜</div>
            </div>
            <div class="interviewer-card" data-role="pm">
              <div class="emoji">ğŸ“Š</div>
              <div class="name">æå§ - äº§å“è´Ÿè´£äºº</div>
              <div class="tag">è„‘ç­‹æ€¥è½¬å¼¯ / è€ƒå¯Ÿæ²Ÿé€š</div>
            </div>
          </div>
          <!-- Custom Interviewer -->
          <div style="margin-top:10px;">
            <button id="addCustomBtn" style="background:#111;border:1px dashed #444;border-radius:8px;padding:10px;width:100%;cursor:pointer;color:#888;font-family:inherit;font-size:12px;transition:all 0.2s;" onmouseover="this.style.borderColor='#ff6644'" onmouseout="this.style.borderColor='#444'">
              ï¼‹ æ·»åŠ è‡ªå®šä¹‰é¢è¯•å®˜
            </button>
            <div id="customForm" style="display:none;background:#111;border:1px solid #333;border-radius:8px;padding:12px;margin-top:8px;">
              <div style="color:#ddd;font-size:12px;margin-bottom:8px;">è‡ªå®šä¹‰é¢è¯•å®˜</div>
              <input id="customName" placeholder="åå­—ï¼ˆå¦‚ï¼šç‹æ€»ï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:6px;outline:none;" maxlength="10">
              <input id="customTitle" placeholder="èŒä½ï¼ˆå¦‚ï¼šæŠ•èµ„æ€»ç›‘ï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:6px;outline:none;" maxlength="20">
              <input id="customPersonality" placeholder="æ€§æ ¼ï¼ˆå¦‚ï¼šè´¨ç–‘å•†ä¸šæ¨¡å¼ã€è¿½é—®æ•°æ®ï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:6px;outline:none;" maxlength="100">
              <input id="customTags" placeholder="æ ‡ç­¾ï¼ˆå¦‚ï¼šè¿½é—®æ•°æ® / è´¨ç–‘å¯è¡Œæ€§ï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:8px;outline:none;" maxlength="40">
              <div style="display:flex;gap:8px;">
                <button id="confirmCustomBtn" style="flex:1;background:#1a0000;border:1px solid #ff4444;border-radius:4px;padding:6px;color:#ff4444;cursor:pointer;font-family:inherit;font-size:11px;">ç¡®è®¤æ·»åŠ </button>
                <button id="cancelCustomBtn" style="flex:1;background:#111;border:1px solid #333;border-radius:4px;padding:6px;color:#888;cursor:pointer;font-family:inherit;font-size:11px;">å–æ¶ˆ</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Candidate Profile (optional) -->
        <div class="setup-section">
          <div class="setup-label" style="cursor:pointer;" id="profileToggle">
            å€™é€‰äººä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç‚¹å‡»å±•å¼€ï¼‰â–¼
          </div>
          <div id="profileForm" style="display:none;background:#111;border:1px solid #333;border-radius:8px;padding:12px;">
            <div style="color:#666;font-size:10px;margin-bottom:8px;">å¡«å†™ä½ çš„ä¿¡æ¯æˆ–ä¸Šä¼ ç®€å†ï¼Œè®©é¢è¯•æ›´æœ‰é’ˆå¯¹æ€§</div>
            <!-- Resume Upload -->
            <div style="margin-bottom:10px;padding:8px;border:1px dashed #333;border-radius:4px;text-align:center;">
              <input type="file" id="resumeFile" accept=".pdf" style="display:none;">
              <button id="uploadResumeBtn" style="background:transparent;border:1px solid #444;border-radius:4px;padding:6px 12px;color:#888;cursor:pointer;font-family:inherit;font-size:11px;">
                ğŸ“„ ä¸Šä¼ ç®€å† PDFï¼ˆè‡ªåŠ¨è§£æï¼‰
              </button>
              <div id="resumeStatus" style="color:#666;font-size:10px;margin-top:4px;display:none;"></div>
            </div>
            <div style="color:#444;font-size:9px;text-align:center;margin-bottom:8px;">â”€â”€ æˆ–æ‰‹åŠ¨å¡«å†™ â”€â”€</div>
            <input id="profileName" placeholder="ä½ çš„åå­—" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:6px;outline:none;" maxlength="20">
            <input id="profileExp" placeholder="å·¥ä½œå¹´é™ï¼ˆå¦‚ï¼š3ï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:6px;outline:none;" maxlength="5">
            <input id="profileStack" placeholder="æŠ€æœ¯æ ˆï¼ˆå¦‚ï¼šReact, TypeScript, Node.jsï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:6px;outline:none;" maxlength="100">
            <input id="profileSalary" placeholder="æœŸæœ›è–ªèµ„ï¼ˆå¦‚ï¼š25k-30kï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;margin-bottom:6px;outline:none;" maxlength="20">
            <input id="profileBg" placeholder="ç®€è¦èƒŒæ™¯ï¼ˆå¦‚ï¼š985æœ¬ç§‘ï¼Œ3å¹´å¤§å‚ç»éªŒï¼‰" style="width:100%;background:#0a0a0a;border:1px solid #333;border-radius:4px;padding:6px 8px;color:#ddd;font-family:inherit;font-size:11px;outline:none;" maxlength="100">
          </div>
        </div>

        <!-- Severity Selection -->
        <div class="setup-section">
          <div class="setup-label">é€‰æ‹© PUA å¼ºåº¦</div>
          <div class="severity-options" id="severityOptions">
            <div class="severity-btn" data-severity="1">ğŸŸ¢ å‹å¥½</div>
            <div class="severity-btn selected" data-severity="2">ğŸŸ¡ æ ‡å‡†</div>
            <div class="severity-btn" data-severity="3">ğŸ”´ åœ°ç‹±</div>
          </div>
        </div>

        <div class="start-hint" id="startHint" style="color:#ff6644;font-size:11px;text-align:center;margin-bottom:8px;">è¯·é€‰æ‹©é¢è¯•å²—ä½ï¼Œå¹¶é€‰æ‹©è‡³å°‘ 2 ä½é¢è¯•å®˜</div>
        <button class="start-btn" id="startBtn" disabled>å¼€å§‹é¢è¯•</button>
        <div style="text-align:center;margin-top:10px;">
          <a href="/" style="color:#666;font-size:11px;text-decoration:none;">é¦–é¡µ</a>
          <span style="color:#333;margin:0 8px;">|</span>
          <a href="/jargon.html" style="color:#666;font-size:11px;text-decoration:none;">é»‘è¯</a>
          <span style="color:#333;margin:0 8px;">|</span>
          <a href="/weekly.html" style="color:#666;font-size:11px;text-decoration:none;">å‘¨æŠ¥</a>
          <span style="color:#333;margin:0 8px;">|</span>
          <a href="/email.html" style="color:#666;font-size:11px;text-decoration:none;">é‚®ä»¶</a>
          <span style="color:#333;margin:0 8px;">|</span>
          <a href="/meeting-suggest.html" style="color:#666;font-size:11px;text-decoration:none;">å‘è¨€</a>
          <span style="color:#333;margin:0 8px;">|</span>
          <a href="/meeting.html" style="color:#666;font-size:11px;text-decoration:none;">ä¼šè®®å®¤</a>
        </div>
      </div>

      <!-- â•â•â• Interview View â•â•â• -->
      <div class="interview-view" id="interviewView">
        <!-- Status Panel -->
        <div class="status-panel" id="statusPanel">
          <div class="status-header">
            <div class="status-round" id="roundDisplay">ç¬¬ 1/10 è½®</div>
            <div class="status-timer" id="timerDisplay">00:00</div>
          </div>
          <div class="meter">
            <div class="meter-label">
              <span class="meter-name">ğŸ”¥ å‹åŠ›</span>
              <span class="meter-value stress" id="stressValue">20%</span>
            </div>
            <div class="meter-bar">
              <div class="meter-fill stress" id="stressFill" style="width:20%"></div>
            </div>
          </div>
          <div class="meter">
            <div class="meter-label">
              <span class="meter-name">ğŸ’ª è‡ªä¿¡</span>
              <span class="meter-value confidence" id="confidenceValue">60%</span>
            </div>
            <div class="meter-bar">
              <div class="meter-fill confidence" id="confidenceFill" style="width:60%"></div>
            </div>
          </div>
        </div>

        <!-- Interviewer Chips -->
        <div class="interviewer-chips" id="interviewerChips"></div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea"></div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">é¢è¯•å®˜æ­£åœ¨æ€è€ƒ...</div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-container" id="inputContainer" style="display:none;">
      <span class="input-prompt">å€™é€‰äºº â¯</span>
      <textarea class="input-field" id="inputField"
        placeholder="è¾“å…¥ä½ çš„å›ç­”..."
        autocomplete="off" spellcheck="false" maxlength="500" rows="1"></textarea>
      <button class="send-btn" id="sendBtn">â¤</button>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="left">
        <span id="statusLabel">ğŸ¯ å‹åŠ›é¢è¯•</span>
      </div>
      <div class="right">
        <a href="/">é¦–é¡µ</a>
        <span class="sep">|</span>
        <a href="/jargon.html">é»‘è¯</a>
        <span class="sep">|</span>
        <a href="/weekly.html">å‘¨æŠ¥</a>
        <span class="sep">|</span>
        <a href="/email.html">é‚®ä»¶</a>
        <span class="sep">|</span>
        <a href="/meeting-suggest.html">å‘è¨€</a>
        <span class="sep">|</span>
        <a href="/meeting.html">ä¼šè®®å®¤</a>
        <span class="sep">|</span>
        <a href="https://github.com/ava-agent/pua-cli" target="_blank" rel="noopener">GitHub</a>
      </div>
    </div>
  </div>

  <!-- Ending Modal -->
  <div class="ending-overlay" id="endingOverlay">
    <div class="ending-card">
      <div class="ending-emoji" id="endingEmoji">ğŸ’€</div>
      <div class="ending-title" id="endingTitle">é¢è¯•ç»“æœ</div>
      <div class="ending-desc" id="endingDesc"></div>
      <div class="ending-stats">
        <div class="ending-stat">
          <div class="ending-stat-value stress" id="endStress">0%</div>
          <div class="ending-stat-label">æœ€ç»ˆå‹åŠ›</div>
        </div>
        <div class="ending-stat">
          <div class="ending-stat-value confidence" id="endConfidence">0%</div>
          <div class="ending-stat-label">æœ€ç»ˆè‡ªä¿¡</div>
        </div>
        <div class="ending-stat">
          <div class="ending-stat-value round" id="endRound">0/10</div>
          <div class="ending-stat-label">åšæŒè½®æ¬¡</div>
        </div>
      </div>
      <div class="ending-actions">
        <button class="retry-btn" id="retryBtn">é‡æ–°é¢è¯•</button>
        <a class="home-btn" href="/">è¿”å›é¦–é¡µ</a>
      </div>
    </div>
  </div>

  <script>
    // â•â•â• State â•â•â•
    let selectedPosition = null;
    let selectedInterviewers = [];
    let selectedSeverity = 2;
    let interviewState = { stress: 20, confidence: 60, round: 1 };
    let history = [];
    let isLoading = false;
    let timerInterval = null;
    let timerSeconds = 0;
    let customInterviewers = [];
    let customCount = 0;
    let candidateProfile = null;

    // â•â•â• Elements â•â•â•
    const setupView = document.getElementById('setupView');
    const interviewView = document.getElementById('interviewView');
    const inputContainer = document.getElementById('inputContainer');
    const inputField = document.getElementById('inputField');
    const sendBtn = document.getElementById('sendBtn');
    const startBtn = document.getElementById('startBtn');
    const chatArea = document.getElementById('chatArea');
    const typingIndicator = document.getElementById('typingIndicator');
    const terminalBody = document.getElementById('terminalBody');
    const endingOverlay = document.getElementById('endingOverlay');

    // Interviewer data
    const INTERVIEWER_DATA = {
      techlead: { emoji: 'ğŸ’»', name: 'åˆ˜å“¥', title: 'æŠ€æœ¯æ€»ç›‘', color: '#4488ff' },
      boss: { emoji: 'ğŸ‘”', name: 'å¼ æ€»', title: 'CTO', color: '#ff4444' },
      hr: { emoji: 'ğŸ’¼', name: 'é™ˆå§', title: 'HR æ€»ç›‘', color: '#cc44cc' },
      pm: { emoji: 'ğŸ“Š', name: 'æå§', title: 'äº§å“è´Ÿè´£äºº', color: '#44cccc' },
    };

    const MOOD_EMOJIS = {
      sarcastic: 'ğŸ˜', pressing: 'ğŸ¤¨', neutral: 'ğŸ˜', cold: 'ğŸ˜¶',
    };

    // â•â•â• Setup Logic â•â•â•

    // Position selection
    document.getElementById('positionGrid').addEventListener('click', (e) => {
      const card = e.target.closest('.position-card');
      if (!card) return;

      document.querySelectorAll('.position-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      selectedPosition = card.dataset.position;
      updateStartBtn();
    });

    // Interviewer selection (toggle)
    document.getElementById('interviewerGrid').addEventListener('click', (e) => {
      const card = e.target.closest('.interviewer-card');
      if (!card) return;

      const role = card.dataset.role;
      if (card.classList.contains('selected')) {
        card.classList.remove('selected');
        selectedInterviewers = selectedInterviewers.filter(r => r !== role);
      } else {
        if (selectedInterviewers.length >= 4) return;
        card.classList.add('selected');
        selectedInterviewers.push(role);
      }
      document.getElementById('interviewerLabel').textContent =
        `é€‰æ‹©é¢è¯•å®˜ï¼ˆå·²é€‰ ${selectedInterviewers.length}/4ï¼Œè‡³å°‘ 2 äººï¼‰`;
      updateStartBtn();
    });

    // Severity selection
    document.getElementById('severityOptions').addEventListener('click', (e) => {
      const btn = e.target.closest('.severity-btn');
      if (!btn) return;

      document.querySelectorAll('.severity-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      selectedSeverity = parseInt(btn.dataset.severity);
    });

    function updateStartBtn() {
      const hint = document.getElementById('startHint');
      const missing = [];
      if (!selectedPosition) missing.push('é€‰æ‹©é¢è¯•å²—ä½');
      if (selectedInterviewers.length < 2) missing.push(`å†é€‰ ${2 - selectedInterviewers.length} ä½é¢è¯•å®˜`);

      if (missing.length > 0) {
        hint.textContent = 'è¿˜éœ€: ' + missing.join('ï¼Œ');
        hint.style.display = 'block';
        startBtn.disabled = true;
      } else {
        hint.style.display = 'none';
        startBtn.disabled = false;
      }
    }

    // â•â•â• Custom Interviewer Logic â•â•â•
    document.getElementById('addCustomBtn').addEventListener('click', () => {
      if (customCount >= 2) {
        document.getElementById('addCustomBtn').textContent = 'æœ€å¤šæ·»åŠ  2 ä¸ªè‡ªå®šä¹‰é¢è¯•å®˜';
        return;
      }
      document.getElementById('customForm').style.display = 'block';
      document.getElementById('addCustomBtn').style.display = 'none';
    });

    document.getElementById('cancelCustomBtn').addEventListener('click', () => {
      document.getElementById('customForm').style.display = 'none';
      document.getElementById('addCustomBtn').style.display = 'block';
    });

    document.getElementById('confirmCustomBtn').addEventListener('click', () => {
      const name = document.getElementById('customName').value.trim();
      const title = document.getElementById('customTitle').value.trim();
      const personality = document.getElementById('customPersonality').value.trim();
      const tags = document.getElementById('customTags').value.trim();

      if (!name || !title || !personality) {
        alert('è¯·è‡³å°‘å¡«å†™åå­—ã€èŒä½å’Œæ€§æ ¼æè¿°');
        return;
      }

      customCount++;
      const customId = 'custom_' + customCount;
      const custom = { id: customId, name, title, personality, tags: tags || personality, emoji: 'ğŸ¤' };
      customInterviewers.push(custom);

      // Add to INTERVIEWER_DATA for rendering
      INTERVIEWER_DATA[customId] = { emoji: 'ğŸ¤', name, title, color: '#ff8844' };

      // Add card to grid
      const card = document.createElement('div');
      card.className = 'interviewer-card';
      card.dataset.role = customId;
      card.innerHTML = `
        <div class="emoji">ğŸ¤</div>
        <div class="name">${escapeHtml(name)} - ${escapeHtml(title)}</div>
        <div class="tag">${escapeHtml(tags || personality)}</div>
      `;
      document.getElementById('interviewerGrid').appendChild(card);

      // Clear form
      document.getElementById('customName').value = '';
      document.getElementById('customTitle').value = '';
      document.getElementById('customPersonality').value = '';
      document.getElementById('customTags').value = '';
      document.getElementById('customForm').style.display = 'none';
      document.getElementById('addCustomBtn').style.display = 'block';
      if (customCount >= 2) {
        document.getElementById('addCustomBtn').textContent = 'å·²æ·»åŠ  2 ä¸ªè‡ªå®šä¹‰é¢è¯•å®˜';
        document.getElementById('addCustomBtn').style.opacity = '0.5';
      }
    });

    // â•â•â• Profile Toggle â•â•â•
    document.getElementById('profileToggle').addEventListener('click', () => {
      const form = document.getElementById('profileForm');
      const toggle = document.getElementById('profileToggle');
      if (form.style.display === 'none') {
        form.style.display = 'block';
        toggle.textContent = 'å€™é€‰äººä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç‚¹å‡»æ”¶èµ·ï¼‰â–²';
      } else {
        form.style.display = 'none';
        toggle.textContent = 'å€™é€‰äººä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç‚¹å‡»å±•å¼€ï¼‰â–¼';
      }
    });

    // â•â•â• Start Interview â•â•â•
    startBtn.addEventListener('click', () => {
      if (!selectedPosition || selectedInterviewers.length < 2) return;

      setupView.style.display = 'none';
      interviewView.style.display = 'block';
      inputContainer.style.display = 'flex';

      // Collect candidate profile
      const pName = document.getElementById('profileName')?.value?.trim();
      const pExp = document.getElementById('profileExp')?.value?.trim();
      const pStack = document.getElementById('profileStack')?.value?.trim();
      const pSalary = document.getElementById('profileSalary')?.value?.trim();
      const pBg = document.getElementById('profileBg')?.value?.trim();

      if (pName || pExp || pStack || pSalary || pBg || resumeText) {
        candidateProfile = {};
        if (pName) candidateProfile.name = pName;
        if (pExp) candidateProfile.experience = parseInt(pExp) || undefined;
        if (pStack) candidateProfile.techStack = pStack;
        if (pSalary) candidateProfile.targetSalary = pSalary;
        if (pBg) candidateProfile.background = pBg;
        if (resumeText) candidateProfile.resumeText = resumeText.slice(0, 1000);
      } else {
        candidateProfile = null;
      }

      // Reset state
      interviewState = { stress: 20, confidence: 60, round: 1 };
      history = [];
      chatArea.innerHTML = '';
      timerSeconds = 0;

      // Update UI
      updateStatusPanel();
      renderInterviewerChips();
      startTimer();

      // Send opening message
      sendOpeningQuestion();

      inputField.focus();
    });

    // â•â•â• Timer â•â•â•
    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timerSeconds++;
        const min = String(Math.floor(timerSeconds / 60)).padStart(2, '0');
        const sec = String(timerSeconds % 60).padStart(2, '0');
        document.getElementById('timerDisplay').textContent = `${min}:${sec}`;
      }, 1000);
    }

    // â•â•â• Status Panel â•â•â•
    function updateStatusPanel() {
      document.getElementById('roundDisplay').textContent =
        `ç¬¬ ${interviewState.round}/10 è½®`;
      document.getElementById('stressValue').textContent = `${interviewState.stress}%`;
      document.getElementById('confidenceValue').textContent = `${interviewState.confidence}%`;
      document.getElementById('stressFill').style.width = `${interviewState.stress}%`;
      document.getElementById('confidenceFill').style.width = `${interviewState.confidence}%`;
    }

    // â•â•â• Interviewer Chips â•â•â•
    function renderInterviewerChips() {
      const container = document.getElementById('interviewerChips');
      container.innerHTML = selectedInterviewers.map(role => {
        const d = INTERVIEWER_DATA[role] || { emoji: 'ğŸ¤', name: role };
        return `<div class="interviewer-chip" id="chip-${role}">
          <span>${d.emoji}</span>
          <span>${d.name}</span>
        </div>`;
      }).join('');
    }

    function setChipSpeaking(role) {
      document.querySelectorAll('.interviewer-chip').forEach(c => c.classList.remove('speaking'));
      const chip = document.getElementById(`chip-${role}`);
      if (chip) chip.classList.add('speaking');
    }

    function clearChipSpeaking() {
      document.querySelectorAll('.interviewer-chip').forEach(c => c.classList.remove('speaking'));
    }

    // â•â•â• Chat Messages â•â•â•
    function addInterviewerMessage(role, content, mood) {
      const d = INTERVIEWER_DATA[role] || { emoji: 'ğŸ¤', name: role, title: '', color: '#ff8844' };
      const moodEmoji = MOOD_EMOJIS[mood] || '';
      const isCustom = role.startsWith('custom_');
      const cssClass = isCustom ? 'custom' : role;

      const msgEl = document.createElement('div');
      msgEl.className = `msg msg-${cssClass}`;
      msgEl.innerHTML = `
        <div class="msg-avatar" style="border-color:${d.color}">${d.emoji}</div>
        <div class="msg-body">
          <div class="msg-name">${d.name} (${d.title}) ${moodEmoji}</div>
          <div class="msg-bubble">${escapeHtml(content)}</div>
        </div>
      `;
      chatArea.appendChild(msgEl);
      scrollToBottom();
    }

    function addUserMessage(content, quality) {
      const qualityLabels = { weak: 'å¼±å›ç­”', normal: 'æ™®é€š', strong: 'å¼ºå›ç­”' };
      const qualityClass = quality || 'normal';

      const msgEl = document.createElement('div');
      msgEl.className = 'msg msg-user';
      msgEl.innerHTML = `
        <div class="msg-avatar" style="border-color:#44ff44">ğŸ™‹</div>
        <div class="msg-body">
          <div class="msg-name">ä½  (å€™é€‰äºº)</div>
          <div class="msg-bubble">${escapeHtml(content)}</div>
          ${quality ? `<span class="quality-badge ${qualityClass}">${qualityLabels[quality]}</span>` : ''}
        </div>
      `;
      chatArea.appendChild(msgEl);
      scrollToBottom();
    }

    function addEventMessage(text) {
      const el = document.createElement('div');
      el.className = 'msg-event';
      el.textContent = text;
      chatArea.appendChild(el);
      scrollToBottom();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function scrollToBottom() {
      requestAnimationFrame(() => {
        terminalBody.scrollTop = terminalBody.scrollHeight;
        requestAnimationFrame(() => {
          terminalBody.scrollTop = terminalBody.scrollHeight;
        });
      });
    }

    // â•â•â• Opening Question â•â•â•
    async function sendOpeningQuestion() {
      isLoading = true;
      sendBtn.disabled = true;
      typingIndicator.style.display = 'block';

      const firstRole = selectedInterviewers[0];
      setChipSpeaking(firstRole);

      try {
        const response = await fetch('/api/interview', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            answer: `ï¼ˆè¿™æ˜¯é¢è¯•çš„ç¬¬ä¸€è½®ã€‚è¯·å‘å€™é€‰äººæå‡ºç¬¬ä¸€ä¸ªé—®é¢˜ã€‚å€™é€‰äººé¢è¯•çš„æ˜¯${getPositionName(selectedPosition)}å²—ä½ã€‚ï¼‰`,
            interviewers: selectedInterviewers,
            position: selectedPosition,
            severity: selectedSeverity,
            state: interviewState,
            history: [],
            customInterviewers: customInterviewers.length > 0 ? customInterviewers : undefined,
            candidateProfile: candidateProfile || undefined,
          }),
        });

        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();

        typingIndicator.style.display = 'none';
        clearChipSpeaking();

        if (data.responses) {
          for (const resp of data.responses) {
            addInterviewerMessage(resp.role, resp.content, resp.mood);
            history.push({ role: 'assistant', content: resp.content });
          }
        }

        if (data.state) {
          interviewState = data.state;
          updateStatusPanel();
        }
      } catch (err) {
        typingIndicator.style.display = 'none';
        clearChipSpeaking();
        addInterviewerMessage(firstRole, 'è¯·å…ˆåšä¸ªè‡ªæˆ‘ä»‹ç»å§ã€‚', 'cold');
        history.push({ role: 'assistant', content: 'è¯·å…ˆåšä¸ªè‡ªæˆ‘ä»‹ç»å§ã€‚' });
      }

      isLoading = false;
      sendBtn.disabled = false;
      inputField.focus();
    }

    // â•â•â• Send Answer â•â•â•
    async function sendAnswer() {
      const content = inputField.value.trim();
      if (!content || isLoading) return;

      // Commands
      if (content === '/quit' || content === '/exit') {
        showEnding({
          title: 'é¢è¯•ä¸­æ–­', description: 'ä½ æå‰ç»“æŸäº†é¢è¯•ã€‚',
          emoji: 'ğŸšª',
        });
        return;
      }
      if (content === '/help') {
        addEventMessage('å‘½ä»¤: /quit æ”¾å¼ƒé¢è¯•');
        return;
      }

      isLoading = true;
      inputField.value = '';
      sendBtn.disabled = true;

      // Show user message
      addUserMessage(content);
      history.push({ role: 'user', content });

      // Show typing
      typingIndicator.style.display = 'block';

      // Highlight likely speaker
      const likelyRole = selectedInterviewers[
        (interviewState.round) % selectedInterviewers.length
      ];
      setChipSpeaking(likelyRole);

      try {
        const response = await fetch('/api/interview', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            answer: content,
            interviewers: selectedInterviewers,
            position: selectedPosition,
            severity: selectedSeverity,
            state: interviewState,
            history: history.slice(-8),
            customInterviewers: customInterviewers.length > 0 ? customInterviewers : undefined,
            candidateProfile: candidateProfile || undefined,
          }),
        });

        if (!response.ok) {
          if (response.status === 429) {
            addEventMessage('â³ è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•');
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
          isLoading = false;
          sendBtn.disabled = false;
          typingIndicator.style.display = 'none';
          clearChipSpeaking();
          return;
        }

        const data = await response.json();

        typingIndicator.style.display = 'none';
        clearChipSpeaking();

        // Update quality badge on user message
        if (data.answerQuality) {
          const userMsgs = chatArea.querySelectorAll('.msg-user');
          const lastUserMsg = userMsgs[userMsgs.length - 1];
          if (lastUserMsg) {
            const qualityLabels = { weak: 'å¼±å›ç­”', normal: 'æ™®é€š', strong: 'å¼ºå›ç­”' };
            const badge = lastUserMsg.querySelector('.quality-badge');
            if (!badge) {
              const newBadge = document.createElement('span');
              newBadge.className = `quality-badge ${data.answerQuality}`;
              newBadge.textContent = qualityLabels[data.answerQuality];
              lastUserMsg.querySelector('.msg-body').appendChild(newBadge);
            }
          }
        }

        // Show event
        if (data.event) {
          addEventMessage(data.event);
        }

        // Update state
        if (data.state) {
          interviewState = data.state;
          updateStatusPanel();
        }

        // Show responses
        if (data.responses) {
          for (const resp of data.responses) {
            setChipSpeaking(resp.role);
            addInterviewerMessage(resp.role, resp.content, resp.mood);
            history.push({ role: 'assistant', content: resp.content });
          }
          clearChipSpeaking();
        }

        // Check ending
        if (data.endResult) {
          clearInterval(timerInterval);
          setTimeout(() => {
            showEnding(data.endResult);
          }, 500);
          return;
        }

      } catch (err) {
        typingIndicator.style.display = 'none';
        clearChipSpeaking();
        if (err.message && err.message.includes('Failed to fetch')) {
          addEventMessage('âš ï¸ ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•');
        } else {
          addEventMessage('âŒ è¯·æ±‚å¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'));
        }
      }

      isLoading = false;
      sendBtn.disabled = false;
      inputField.focus();
    }

    // â•â•â• Ending â•â•â•
    function showEnding(result) {
      clearInterval(timerInterval);
      inputContainer.style.display = 'none';

      document.getElementById('endingEmoji').textContent = result.emoji;
      document.getElementById('endingTitle').textContent = result.title;
      document.getElementById('endingDesc').textContent = result.description;
      document.getElementById('endStress').textContent = `${interviewState.stress}%`;
      document.getElementById('endConfidence').textContent = `${interviewState.confidence}%`;
      document.getElementById('endRound').textContent = `${interviewState.round}/10`;

      endingOverlay.classList.add('show');
    }

    document.getElementById('retryBtn').addEventListener('click', () => {
      endingOverlay.classList.remove('show');
      setupView.style.display = 'block';
      interviewView.style.display = 'none';
      inputContainer.style.display = 'none';
      clearInterval(timerInterval);
      // Reset custom interviewer state
      customInterviewers = [];
      customCount = 0;
      const addedCards = document.querySelectorAll('.custom-interviewer-added');
      addedCards.forEach(card => card.remove());
      // Reset candidate profile
      candidateProfile = {};
      resumeText = '';
      const profileInputs = document.querySelectorAll('.candidate-section input');
      profileInputs.forEach(input => input.value = '');
      // Reset chat area
      chatArea.innerHTML = '';
    });

    // â•â•â• Input Handlers â•â•â•
    sendBtn.addEventListener('click', sendAnswer);

    inputField.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendAnswer();
      }
    });

    inputField.addEventListener('input', () => {
      inputField.style.height = 'auto';
      inputField.style.height = Math.min(inputField.scrollHeight, 120) + 'px';
    });

    // â•â•â• Resume Upload â•â•â•
    let resumeText = null;

    document.getElementById('uploadResumeBtn').addEventListener('click', () => {
      document.getElementById('resumeFile').click();
    });

    document.getElementById('resumeFile').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.name.toLowerCase().endsWith('.pdf')) {
        showResumeStatus('ä»…æ”¯æŒ PDF æ ¼å¼', true);
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        showResumeStatus('æ–‡ä»¶å¤ªå¤§ï¼ˆæœ€å¤§ 5MBï¼‰', true);
        return;
      }

      showResumeStatus('æ­£åœ¨è§£æç®€å†...', false);

      try {
        const text = await extractPDFText(file);
        if (!text || text.trim().length === 0) {
          showResumeStatus('æ— æ³•æå–æ–‡æœ¬ï¼ˆå¯èƒ½æ˜¯æ‰«æä»¶ï¼‰', true);
          return;
        }

        resumeText = text.trim();
        const profile = extractProfileFromText(resumeText);

        // Fill form fields
        if (profile.name) document.getElementById('profileName').value = profile.name;
        if (profile.experience) document.getElementById('profileExp').value = String(profile.experience);
        if (profile.techStack) document.getElementById('profileStack').value = profile.techStack;
        if (profile.targetSalary) document.getElementById('profileSalary').value = profile.targetSalary;
        if (profile.background) document.getElementById('profileBg').value = profile.background;

        showResumeStatus(`è§£ææˆåŠŸï¼æå–äº† ${resumeText.length} å­—`, false);
      } catch (err) {
        showResumeStatus('è§£æå¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'), true);
      }
    });

    function showResumeStatus(msg, isError) {
      const el = document.getElementById('resumeStatus');
      el.textContent = msg;
      el.style.display = 'block';
      el.style.color = isError ? '#ff4444' : '#44ff44';
    }

    // Simple PDF text extraction using pdf.js
    async function extractPDFText(file) {
      // Load pdf.js dynamically
      if (!window.pdfjsLib) {
        await loadScript('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js');
        window.pdfjsLib.GlobalWorkerOptions.workerSrc =
          'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
      }

      const arrayBuffer = await file.arrayBuffer();
      const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      let text = '';

      for (let i = 1; i <= Math.min(pdf.numPages, 5); i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(item => item.str).join(' ') + '\n';
      }

      return text;
    }

    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    // Extract profile from resume text (client-side)
    function extractProfileFromText(text) {
      const profile = {};
      const lines = text.split('\n').filter(l => l.trim().length > 0);

      // Name (first line, 2-4 Chinese chars)
      if (lines.length > 0) {
        const first = lines[0].trim();
        if (/^[\u4e00-\u9fa5]{2,4}$/.test(first)) profile.name = first;
      }

      // Experience
      const expMatch = text.match(/(\d{1,2})\s*[å¹´å¹´]\s*(?:å·¥ä½œ|å¼€å‘|ä»ä¸š|é¡¹ç›®)/);
      if (expMatch) profile.experience = parseInt(expMatch[1]);

      // Tech stack
      const techs = ['React','Vue','Angular','TypeScript','JavaScript','Node.js',
        'Python','Java','Go','Rust','C++','MySQL','PostgreSQL','MongoDB','Redis',
        'Docker','Kubernetes','AWS','Git','Webpack','Next.js','Spring','Django',
        'Flask','Express','GraphQL','Figma','Sketch'];
      const found = techs.filter(t => text.toLowerCase().includes(t.toLowerCase()));
      if (found.length > 0) profile.techStack = found.slice(0, 10).join(', ');

      // Salary
      const salaryMatch = text.match(/(?:æœŸæœ›|ç›®æ ‡|è–ªèµ„|æœˆè–ª)[ï¼š:]\s*(.{3,20})/);
      if (salaryMatch) profile.targetSalary = salaryMatch[1].trim();

      // Education
      const eduMatch = text.match(/(æœ¬ç§‘|ç¡•å£«|åšå£«|985|211|Bachelor|Master|PhD).{0,30}/i);
      if (eduMatch) profile.background = eduMatch[0].trim();

      return profile;
    }

    // â•â•â• Helpers â•â•â•
    function getPositionName(pos) {
      const names = {
        frontend: 'å‰ç«¯å¼€å‘', backend: 'åç«¯å¼€å‘',
        product: 'äº§å“ç»ç†', design: 'UI/UX è®¾è®¡å¸ˆ',
      };
      return names[pos] || pos;
    }
  </script>
</body>
</html>
