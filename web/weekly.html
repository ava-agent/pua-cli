<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‘¨æŠ¥ç”Ÿæˆå™¨ - PUA CLI</title>
  <meta name="description" content="å‘¨æŠ¥ç”Ÿæˆå™¨ - ä¸€é”®ç”Ÿæˆå„è§’è‰²é£æ ¼çš„èŒåœºå‘¨æŠ¥ï¼Œ6ç§è§’è‰²ä»»é€‰">
  <meta property="og:title" content="å‘¨æŠ¥ç”Ÿæˆå™¨ - PUA CLI">
  <meta property="og:description" content="ä¸€é”®ç”Ÿæˆå„è§’è‰²é£æ ¼çš„èŒåœºå‘¨æŠ¥ï¼Œæ”¯æŒè€æ¿ã€å‘˜å·¥ã€äº§å“ç»ç†ã€HRã€æŠ€æœ¯ä¸»ç®¡ã€å®ä¹ ç”Ÿ">
  <meta name="theme-color" content="#0a0a0a">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“‹</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'JetBrains Mono', 'Consolas', monospace;
      background: #0a0a0a;
      min-height: 100vh;
      overflow-x: hidden;
      color: #e0e0e0;
    }

    /* === Nav Bar === */
    .nav-bar {
      position: sticky;
      top: 0;
      z-index: 50;
      background: #111;
      border-bottom: 1px solid #222;
      padding: 0 16px;
      display: flex;
      align-items: center;
      gap: 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .nav-bar::-webkit-scrollbar { height: 0; }

    .nav-link {
      color: #666;
      text-decoration: none;
      font-size: 12px;
      padding: 10px 14px;
      white-space: nowrap;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
      flex-shrink: 0;
    }

    .nav-link:hover {
      color: #ccc;
      background: #1a1a1a;
    }

    .nav-link.active {
      color: #00ccff;
      border-bottom-color: #00ccff;
    }

    /* === Terminal Shell === */
    .terminal {
      width: 90%;
      max-width: 900px;
      margin: 30px auto 40px;
      background: #0a0a0a;
      border: 1px solid #333;
      border-radius: 8px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.6);
      overflow: hidden;
    }

    .terminal-header {
      padding: 10px 16px;
      background: #1a1a1a;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 1px solid #333;
    }

    .terminal-buttons { display: flex; gap: 8px; }
    .terminal-btn { width: 12px; height: 12px; border-radius: 50%; }
    .terminal-btn.close { background: #ff5f56; }
    .terminal-btn.minimize { background: #ffbd2e; }
    .terminal-btn.maximize { background: #27ca3f; }
    .terminal-title { color: #888; font-size: 12px; flex: 1; text-align: center; }

    .terminal-body {
      padding: 24px;
      overflow-y: auto;
      background: #0a0a0a;
    }

    .terminal-body::-webkit-scrollbar { width: 8px; }
    .terminal-body::-webkit-scrollbar-track { background: #0a0a0a; }
    .terminal-body::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    .terminal-body::-webkit-scrollbar-thumb:hover { background: #444; }

    /* === Setup Header === */
    .setup-header {
      text-align: center;
      margin-bottom: 28px;
    }

    .setup-header .logo-emoji {
      font-size: 48px;
      display: block;
      margin-bottom: 8px;
      animation: floatBounce 3s ease-in-out infinite;
    }

    @keyframes floatBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .setup-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 6px;
      background: linear-gradient(90deg, #00ccff, #00ff88);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .setup-subtitle {
      color: #666;
      font-size: 12px;
    }

    /* === Section Labels === */
    .section-label {
      color: #888;
      font-size: 13px;
      margin-bottom: 12px;
      display: block;
    }

    /* === Role Grid === */
    .role-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 28px;
    }

    .role-card {
      background: #111;
      border: 2px solid #333;
      border-radius: 12px;
      padding: 16px 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s;
      user-select: none;
      position: relative;
    }

    .role-card:hover {
      border-color: #555;
      transform: translateY(-2px);
    }

    .role-card.selected {
      border-color: #00ccff;
      background: #0a1a2a;
      box-shadow: 0 0 20px rgba(0, 204, 255, 0.15);
    }

    .role-card.selected .role-check {
      opacity: 1;
      transform: scale(1);
    }

    .role-check {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #00ccff;
      color: #000;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: scale(0);
      transition: all 0.25s;
    }

    .role-emoji {
      font-size: 32px;
      margin-bottom: 6px;
    }

    .role-name {
      color: #fff;
      font-size: 13px;
      font-weight: 700;
    }

    .role-desc {
      color: #666;
      font-size: 10px;
      margin-top: 4px;
    }

    /* === Week Selector === */
    .week-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 28px;
    }

    .week-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #111;
      border: 1px solid #333;
      color: #00ccff;
      font-size: 18px;
      font-family: inherit;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .week-btn:hover {
      border-color: #00ccff;
      background: #0a1a2a;
    }

    .week-display {
      font-size: 16px;
      color: #e0e0e0;
      min-width: 120px;
      text-align: center;
    }

    .week-display .number {
      color: #00ccff;
      font-weight: 700;
      font-size: 20px;
    }

    /* === Generate Button === */
    .generate-btn {
      display: block;
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #0088cc, #00aaff);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }

    .generate-btn:hover {
      background: linear-gradient(135deg, #00aaff, #00ccff);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(0, 204, 255, 0.3);
    }

    .generate-btn:disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .generate-hint {
      color: #555;
      font-size: 11px;
      text-align: center;
      margin-bottom: 24px;
    }

    /* === Report Container === */
    .report-container {
      display: none;
      animation: fadeSlideIn 0.4s ease-out;
    }

    .report-container.visible {
      display: block;
    }

    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* === Report Box === */
    .report-box {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 16px;
    }

    .report-header {
      text-align: center;
      padding-bottom: 16px;
      margin-bottom: 20px;
      border-bottom: 1px dashed #333;
    }

    .report-title {
      font-size: 16px;
      font-weight: 700;
      color: #00ccff;
      margin-bottom: 4px;
    }

    .report-meta {
      color: #666;
      font-size: 11px;
    }

    /* Report Sections */
    .report-section {
      margin-bottom: 20px;
    }

    .report-section:last-child {
      margin-bottom: 0;
    }

    .report-section-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 1px solid #222;
    }

    .report-section-title.highlights { color: #44ff44; }
    .report-section-title.plans { color: #ffcc00; }
    .report-section-title.risks { color: #ff4444; }
    .report-section-title.data { color: #4488ff; }

    .report-item {
      color: #b8b8b8;
      font-size: 13px;
      line-height: 1.8;
      padding-left: 4px;
    }

    .report-item .ordinal {
      color: #888;
      margin-right: 6px;
    }

    /* === Action Buttons === */
    .action-buttons {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      font-family: inherit;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .action-btn.copy {
      background: #0a1a2a;
      border: 1px solid #00ccff;
      color: #00ccff;
    }

    .action-btn.copy:hover {
      background: #0d2040;
      box-shadow: 0 0 12px rgba(0, 204, 255, 0.2);
    }

    .action-btn.copy.copied {
      background: #0a2a0a;
      border-color: #44ff44;
      color: #44ff44;
    }

    .action-btn.regenerate {
      background: #111;
      border: 1px solid #333;
      color: #888;
    }

    .action-btn.regenerate:hover {
      border-color: #666;
      color: #ccc;
    }

    /* === Status Bar === */
    .status-bar {
      padding: 6px 16px;
      background: #111;
      border-top: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #555;
    }

    .status-bar .left { color: #00ccff; }
    .status-bar .right { color: #666; }
    .status-bar a { color: #00ccff; text-decoration: none; transition: color 0.2s; }
    .status-bar a:hover { color: #00ffff; }
    .status-bar .sep { color: #444; margin: 0 6px; }

    /* === Work Items Textarea === */
    .work-items-input {
      width: 100%;
      min-height: 80px;
      max-height: 160px;
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px 14px;
      color: #e0e0e0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s;
      margin-bottom: 28px;
    }
    .work-items-input:focus { border-color: #00ccff; }
    .work-items-input::placeholder { color: #444; }

    /* === Report Body (AI response) === */
    .report-body {
      color: #b8b8b8;
      font-size: 13px;
      line-height: 1.8;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    /* === Responsive === */
    @media (max-width: 600px) {
      .terminal {
        width: 95%;
        margin: 15px auto 30px;
      }

      .terminal-body {
        padding: 16px;
      }

      .role-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .role-emoji { font-size: 26px; }
      .role-name { font-size: 12px; }
      .role-card { padding: 12px 8px; }

      .setup-title { font-size: 18px; }

      .report-box { padding: 16px; }

      .action-buttons { flex-direction: column; }

      .nav-link { padding: 8px 10px; font-size: 11px; }

      .status-bar {
        flex-direction: column;
        gap: 4px;
        align-items: flex-start;
      }
    }
  </style>
  <!-- Vercel Web Analytics -->
  <script>window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };</script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body>

<!-- Nav Bar -->
<nav class="nav-bar">
  <a class="nav-link" href="index.html">é¦–é¡µ</a>
  <a class="nav-link" href="jargon.html">é»‘è¯ç”Ÿæˆ</a>
  <a class="nav-link active" href="weekly.html">å‘¨æŠ¥ç”Ÿæˆ</a>
  <a class="nav-link" href="email.html">é‚®ä»¶è½¬æ¢</a>
  <a class="nav-link" href="meeting-suggest.html">ä¼šè®®å‘è¨€</a>
  <a class="nav-link" href="meeting.html">ä¼šè®®å®¤</a>
  <a class="nav-link" href="interview.html">å‹åŠ›é¢è¯•</a>
</nav>

<div class="terminal">
  <div class="terminal-header">
    <div class="terminal-buttons">
      <span class="terminal-btn close"></span>
      <span class="terminal-btn minimize"></span>
      <span class="terminal-btn maximize"></span>
    </div>
    <div class="terminal-title">å‘¨æŠ¥ç”Ÿæˆå™¨ â€” pua-cli</div>
  </div>

  <div class="terminal-body" id="terminalBody">
    <!-- Setup Header -->
    <div class="setup-header">
      <span class="logo-emoji">ğŸ“‹</span>
      <div class="setup-title">å‘¨æŠ¥ç”Ÿæˆå™¨</div>
      <div class="setup-subtitle">ä¸€é”®ç”Ÿæˆå„è§’è‰²é£æ ¼çš„èŒåœºå‘¨æŠ¥</div>
    </div>

    <!-- Role Selection -->
    <span class="section-label">é€‰æ‹©è§’è‰²</span>
    <div class="role-grid" id="roleGrid">
      <div class="role-card" data-role="boss">
        <span class="role-check">âœ“</span>
        <div class="role-emoji">ğŸ‘”</div>
        <div class="role-name">è€æ¿</div>
        <div class="role-desc">æŒ‡å¯¼ç›‘ç£ / ç®¡ç†å±‚è§†è§’</div>
      </div>
      <div class="role-card" data-role="employee">
        <span class="role-check">âœ“</span>
        <div class="role-emoji">ğŸ˜“</div>
        <div class="role-name">å‘˜å·¥</div>
        <div class="role-desc">å®Œæˆä»»åŠ¡ / æ‰“å·¥äººæ—¥å¸¸</div>
      </div>
      <div class="role-card" data-role="pm">
        <span class="role-check">âœ“</span>
        <div class="role-emoji">ğŸ“‹</div>
        <div class="role-name">äº§å“ç»ç†</div>
        <div class="role-desc">éœ€æ±‚è¯„å®¡ / äº§å“è¿­ä»£</div>
      </div>
      <div class="role-card" data-role="hr">
        <span class="role-check">âœ“</span>
        <div class="role-emoji">ğŸ’¼</div>
        <div class="role-name">HR</div>
        <div class="role-desc">å›¢é˜Ÿå»ºè®¾ / ä¼ä¸šæ–‡åŒ–</div>
      </div>
      <div class="role-card" data-role="techlead">
        <span class="role-check">âœ“</span>
        <div class="role-emoji">ğŸ’»</div>
        <div class="role-name">æŠ€æœ¯ä¸»ç®¡</div>
        <div class="role-desc">ä»£ç å®¡æŸ¥ / æ¶æ„é‡æ„</div>
      </div>
      <div class="role-card" data-role="intern">
        <span class="role-check">âœ“</span>
        <div class="role-emoji">ğŸŒ±</div>
        <div class="role-name">å®ä¹ ç”Ÿ</div>
        <div class="role-desc">å­¦ä¹ æˆé•¿ / è™šå¿ƒè¯·æ•™</div>
      </div>
    </div>

    <!-- Week Selector -->
    <span class="section-label">é€‰æ‹©å‘¨æ•°</span>
    <div class="week-selector">
      <button class="week-btn" id="weekMinus" title="ä¸Šä¸€å‘¨">-</button>
      <div class="week-display">ç¬¬ <span class="number" id="weekNumber">1</span> å‘¨</div>
      <button class="week-btn" id="weekPlus" title="ä¸‹ä¸€å‘¨">+</button>
    </div>

    <!-- Work Items Input -->
    <span class="section-label">æœ¬å‘¨å·¥ä½œå†…å®¹</span>
    <textarea id="workItemsInput" class="work-items-input" placeholder="æè¿°ä½ æœ¬å‘¨åšäº†ä»€ä¹ˆï¼Œä¾‹å¦‚ï¼š&#10;å®Œæˆäº†ç”¨æˆ·æ¨¡å—å¼€å‘&#10;å‚åŠ äº†3æ¬¡éœ€æ±‚è¯„å®¡&#10;ä¿®å¤äº†5ä¸ªçº¿ä¸Šbug" rows="4" maxlength="500"></textarea>

    <!-- Generate Button -->
    <button class="generate-btn" id="generateBtn" disabled>ç”Ÿæˆå‘¨æŠ¥</button>
    <div class="generate-hint" id="generateHint">è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§’è‰²å¹¶å¡«å†™å·¥ä½œå†…å®¹</div>

    <!-- Report Result -->
    <div class="report-container" id="reportContainer">
      <div class="report-box" id="reportBox">
        <!-- Filled by JS -->
      </div>
      <div class="action-buttons">
        <button class="action-btn copy" id="copyBtn">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
        <button class="action-btn regenerate" id="regenerateBtn">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
      </div>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="status-bar">
    <div class="left">
      <span>ğŸ“‹ å‘¨æŠ¥ç”Ÿæˆå™¨</span>
    </div>
    <div class="right">
      <a href="index.html">é¦–é¡µ</a>
      <span class="sep">|</span>
      <a href="jargon.html">é»‘è¯</a>
      <span class="sep">|</span>
      <a href="email.html">é‚®ä»¶</a>
      <span class="sep">|</span>
      <a href="meeting-suggest.html">å‘è¨€</a>
      <span class="sep">|</span>
      <a href="meeting.html">ä¼šè®®å®¤</a>
      <span class="sep">|</span>
      <a href="interview.html">é¢è¯•</a>
      <span class="sep">|</span>
      <a href="https://github.com/ava-agent/pua-cli" target="_blank" rel="noopener">GitHub</a>
    </div>
  </div>
</div>

<script>
// ==================== DATA ====================
const ROLE_NAMES = {
  boss: 'è€æ¿',
  employee: 'å‘˜å·¥',
  pm: 'äº§å“ç»ç†',
  hr: 'HR',
  techlead: 'æŠ€æœ¯ä¸»ç®¡',
  intern: 'å®ä¹ ç”Ÿ'
};

const CHINESE_ORDINALS = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”'];

// ==================== STATE ====================
let selectedRole = null;
let currentWeek = getWeekNumber(new Date());
let isGenerating = false;
let lastReportText = '';

// ==================== WEEK CALCULATION ====================
function getWeekNumber(date) {
  const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
  const pastDaysOfYear = (date.getTime() - firstDayOfYear.getTime()) / 86400000;
  return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
}

// ==================== HELPERS ====================
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// ==================== API CALL ====================
async function callWeeklyApi(role, workItems, weekNumber) {
  const response = await fetch('/api/weekly', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ role, workItems, weekNumber })
  });

  if (!response.ok) {
    const errorData = await response.json().catch(() => null);
    const message = (errorData && errorData.error) || `è¯·æ±‚å¤±è´¥ (${response.status})`;
    throw new Error(message);
  }

  const data = await response.json();
  return data.result;
}

// ==================== GENERATION ====================
async function handleGenerate() {
  if (!selectedRole || isGenerating) return;

  const workItemsInput = document.getElementById('workItemsInput');
  const workItems = workItemsInput.value.trim();
  if (!workItems) return;

  const generateBtn = document.getElementById('generateBtn');
  const regenerateBtn = document.getElementById('regenerateBtn');

  // Set loading state
  isGenerating = true;
  generateBtn.disabled = true;
  generateBtn.textContent = 'ç”Ÿæˆä¸­...';
  regenerateBtn.disabled = true;

  try {
    const resultText = await callWeeklyApi(selectedRole, workItems, currentWeek);
    lastReportText = resultText;
    renderReport(selectedRole, currentWeek, resultText);
  } catch (err) {
    showError(err.message || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  } finally {
    isGenerating = false;
    generateBtn.textContent = 'ç”Ÿæˆå‘¨æŠ¥';
    regenerateBtn.disabled = false;
    updateGenerateButton();
  }
}

function showError(message) {
  const errorDiv = document.createElement('div');
  errorDiv.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#331111;border:1px solid #ff4444;color:#ff6666;padding:12px 24px;border-radius:8px;font-family:inherit;font-size:13px;z-index:9999;animation:fadeSlideIn 0.3s ease-out;';
  errorDiv.textContent = message;
  document.body.appendChild(errorDiv);
  setTimeout(() => {
    errorDiv.style.opacity = '0';
    errorDiv.style.transition = 'opacity 0.3s';
    setTimeout(() => document.body.removeChild(errorDiv), 300);
  }, 3000);
}

function renderReport(role, week, text) {
  const reportBox = document.getElementById('reportBox');
  const roleName = ROLE_NAMES[role] || role;

  reportBox.innerHTML = `
    <div class="report-header">
      <div class="report-title">å‘¨æŠ¥ - ${escapeHtml(roleName)} - ç¬¬${week}å‘¨</div>
      <div class="report-meta">ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}</div>
    </div>
    <div class="report-body">${escapeHtml(text)}</div>
  `;

  const container = document.getElementById('reportContainer');
  container.classList.remove('visible');
  // Trigger reflow for animation
  void container.offsetWidth;
  container.classList.add('visible');

  // Scroll to report
  requestAnimationFrame(() => {
    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
}

// ==================== COPY TO CLIPBOARD ====================
function getReportPlainText() {
  const reportBox = document.getElementById('reportBox');
  const titleEl = reportBox.querySelector('.report-title');
  const bodyEl = reportBox.querySelector('.report-body');

  if (!titleEl || !bodyEl) return '';

  const title = titleEl.textContent;
  let text = title + '\n';
  text += '='.repeat(title.length * 2) + '\n\n';
  text += bodyEl.textContent;

  return text.trim();
}

// ==================== INIT ====================
function init() {
  // Set week display
  updateWeekDisplay();

  const workItemsInput = document.getElementById('workItemsInput');

  // Role selection
  const roleGrid = document.getElementById('roleGrid');
  roleGrid.addEventListener('click', (e) => {
    const card = e.target.closest('.role-card');
    if (!card) return;

    document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    selectedRole = card.dataset.role;
    updateGenerateButton();
  });

  // Work items input - update button state on input
  workItemsInput.addEventListener('input', () => {
    updateGenerateButton();
  });

  // Week buttons
  document.getElementById('weekMinus').addEventListener('click', () => {
    if (currentWeek > 1) {
      currentWeek--;
      updateWeekDisplay();
    }
  });

  document.getElementById('weekPlus').addEventListener('click', () => {
    if (currentWeek < 53) {
      currentWeek++;
      updateWeekDisplay();
    }
  });

  // Generate button
  document.getElementById('generateBtn').addEventListener('click', () => {
    handleGenerate();
  });

  // Copy button
  document.getElementById('copyBtn').addEventListener('click', () => {
    const text = getReportPlainText();
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copyBtn');
      btn.textContent = 'âœ“ å·²å¤åˆ¶';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿';
        btn.classList.remove('copied');
      }, 2000);
    }).catch(() => {
      // Fallback for older browsers
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        const btn = document.getElementById('copyBtn');
        btn.textContent = 'âœ“ å·²å¤åˆ¶';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿';
          btn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        // Silently fail
      }
      document.body.removeChild(textarea);
    });
  });

  // Regenerate button
  document.getElementById('regenerateBtn').addEventListener('click', () => {
    handleGenerate();
  });
}

function updateWeekDisplay() {
  document.getElementById('weekNumber').textContent = currentWeek;
}

function updateGenerateButton() {
  const btn = document.getElementById('generateBtn');
  const hint = document.getElementById('generateHint');
  const workItemsInput = document.getElementById('workItemsInput');
  const hasWorkItems = workItemsInput.value.trim().length > 0;

  if (selectedRole && hasWorkItems && !isGenerating) {
    btn.disabled = false;
    hint.textContent = `å½“å‰è§’è‰²: ${ROLE_NAMES[selectedRole]}`;
  } else {
    btn.disabled = true;
    if (!selectedRole && !hasWorkItems) {
      hint.textContent = 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§’è‰²å¹¶å¡«å†™å·¥ä½œå†…å®¹';
    } else if (!selectedRole) {
      hint.textContent = 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§’è‰²';
    } else if (!hasWorkItems) {
      hint.textContent = 'è¯·å¡«å†™æœ¬å‘¨å·¥ä½œå†…å®¹';
    } else {
      hint.textContent = 'ç”Ÿæˆä¸­...';
    }
  }
}

// Start
init();
</script>

</body>
</html>
