<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é‚®ä»¶è¯­æ°”è½¬æ¢å™¨ - PUA CLI</title>
  <meta name="description" content="é‚®ä»¶è¯­æ°”è½¬æ¢å™¨ - ä¸€é”®è½¬æ¢èŒåœºé‚®ä»¶çš„è¯­æ°”å’Œé£æ ¼ï¼Œæ”¯æŒå¤šè§’è‰²å¤šè¯­æ°”">
  <meta property="og:title" content="é‚®ä»¶è¯­æ°”è½¬æ¢å™¨ - PUA CLI">
  <meta property="og:description" content="ä¸€é”®è½¬æ¢èŒåœºé‚®ä»¶çš„è¯­æ°”å’Œé£æ ¼ï¼Œæ”¯æŒPMã€å‘˜å·¥ã€HRç­‰è§’è‰²é—´çš„é‚®ä»¶è½¬æ¢">
  <meta property="og:type" content="website">
  <meta name="theme-color" content="#0a0a0a">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“§</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'JetBrains Mono', 'Consolas', monospace;
      background: #0a0a0a;
      min-height: 100vh;
      overflow-x: hidden;
      color: #e0e0e0;
    }

    /* === Nav Bar === */
    .nav-bar {
      position: sticky;
      top: 0;
      z-index: 50;
      background: #111;
      border-bottom: 1px solid #222;
      padding: 0 16px;
      display: flex;
      align-items: center;
      gap: 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .nav-bar::-webkit-scrollbar { height: 0; }
    .nav-link {
      color: #666;
      text-decoration: none;
      font-size: 12px;
      padding: 10px 14px;
      white-space: nowrap;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
      flex-shrink: 0;
    }
    .nav-link:hover {
      color: #ccc;
      background: #1a1a1a;
    }
    .nav-link.active {
      color: #00ccff;
      border-bottom-color: #00ccff;
    }

    /* === Terminal Shell === */
    .terminal {
      width: 90%;
      max-width: 900px;
      margin: 30px auto 40px;
      background: #0a0a0a;
      border: 1px solid #333;
      border-radius: 8px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      min-height: calc(100vh - 120px);
      overflow: hidden;
    }

    .terminal-header {
      padding: 10px 16px;
      background: #1a1a1a;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 1px solid #333;
    }

    .terminal-buttons { display: flex; gap: 8px; }
    .terminal-btn { width: 12px; height: 12px; border-radius: 50%; }
    .terminal-btn.close { background: #ff5f56; }
    .terminal-btn.minimize { background: #ffbd2e; }
    .terminal-btn.maximize { background: #27ca3f; }
    .terminal-title { color: #888; font-size: 12px; flex: 1; text-align: center; }

    /* === Main Content === */
    .terminal-body {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      overflow-x: hidden;
      background: #0a0a0a;
      scroll-behavior: smooth;
    }

    .terminal-body::-webkit-scrollbar { width: 8px; }
    .terminal-body::-webkit-scrollbar-track { background: #0a0a0a; }
    .terminal-body::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    .terminal-body::-webkit-scrollbar-thumb:hover { background: #444; }

    /* === Setup Header === */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; }
    }

    .setup-view { animation: fadeIn 0.3s ease-out; }

    .setup-header {
      text-align: center;
      margin-bottom: 28px;
    }

    .setup-header .logo-emoji {
      font-size: 48px;
      display: block;
      margin-bottom: 8px;
      animation: floatBounce 3s ease-in-out infinite;
    }

    @keyframes floatBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .setup-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 6px;
      background: linear-gradient(90deg, #00ccff, #aa44ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .setup-subtitle {
      color: #666;
      font-size: 12px;
      margin-bottom: 4px;
    }

    /* === Section Labels === */
    .section-label {
      color: #888;
      font-size: 13px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-label .badge {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 700;
    }

    .section-label .badge-from {
      background: #0a1122;
      color: #4488ff;
      border: 1px solid #4488ff;
    }

    .section-label .badge-to {
      background: #1a1108;
      color: #ff8844;
      border: 1px solid #ff8844;
    }

    /* === Setup Sections === */
    .setup-section {
      margin-bottom: 22px;
    }

    /* === Role Cards Grid === */
    .role-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .role-card {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s;
      user-select: none;
      position: relative;
    }

    .role-card:hover {
      border-color: #555;
      transform: translateY(-1px);
    }

    .role-card .emoji { font-size: 22px; display: block; margin-bottom: 4px; }
    .role-card .name { color: #ddd; font-size: 12px; font-weight: 500; }
    .role-card .desc { color: #555; font-size: 9px; margin-top: 3px; }

    /* From card selected */
    .role-card.from-selected {
      border-color: #4488ff;
      background: #0a1122;
      box-shadow: 0 0 16px rgba(68, 136, 255, 0.1);
    }

    .role-card.from-selected .name { color: #4488ff; }

    .role-card.from-selected::after {
      content: 'FROM';
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 8px;
      font-weight: 700;
      color: #4488ff;
      background: #0a1133;
      padding: 1px 4px;
      border-radius: 3px;
    }

    /* To card selected */
    .role-card.to-selected {
      border-color: #ff8844;
      background: #1a1108;
      box-shadow: 0 0 16px rgba(255, 136, 68, 0.1);
    }

    .role-card.to-selected .name { color: #ff8844; }

    .role-card.to-selected::after {
      content: 'TO';
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 8px;
      font-weight: 700;
      color: #ff8844;
      background: #1a1108;
      padding: 1px 4px;
      border-radius: 3px;
    }

    /* === Direction Arrow === */
    .direction-display {
      text-align: center;
      margin: 4px 0 16px;
      font-size: 12px;
      color: #555;
      min-height: 24px;
      transition: all 0.2s;
    }

    .direction-display .arrow { color: #00ccff; margin: 0 8px; }
    .direction-display .from-name { color: #4488ff; }
    .direction-display .to-name { color: #ff8844; }
    .direction-display .unsupported { color: #ff4444; font-size: 11px; }

    /* === Tone Cards === */
    .tone-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .tone-card {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s;
      user-select: none;
    }

    .tone-card:hover {
      border-color: #555;
      transform: translateY(-1px);
    }

    .tone-card .emoji { font-size: 20px; display: block; margin-bottom: 4px; }
    .tone-card .name { color: #ddd; font-size: 12px; font-weight: 500; }
    .tone-card .desc { color: #555; font-size: 9px; margin-top: 3px; }

    .tone-card.selected {
      border-color: #00ccff;
      background: #0a1a22;
      box-shadow: 0 0 16px rgba(0, 204, 255, 0.1);
    }

    .tone-card.selected .name { color: #00ccff; }

    /* === Content Input === */
    .content-area {
      width: 100%;
      min-height: 100px;
      max-height: 200px;
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px 14px;
      color: #e0e0e0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s;
    }

    .content-area:focus {
      border-color: #00ccff;
    }

    .content-area::placeholder {
      color: #444;
    }

    /* === Convert Button === */
    .convert-btn {
      width: 100%;
      padding: 14px;
      margin-top: 8px;
      background: linear-gradient(135deg, #006688, #00ccff);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-family: 'JetBrains Mono', monospace;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 2px;
    }

    .convert-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(0, 204, 255, 0.3);
    }

    .convert-btn:active {
      transform: translateY(0);
    }

    .convert-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* === Result Area === */
    .result-area {
      margin-top: 24px;
      animation: fadeIn 0.3s ease-out;
      display: none;
    }

    .result-area.visible { display: block; }

    .result-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .result-header-title {
      color: #888;
      font-size: 13px;
    }

    .result-info {
      background: #111;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 8px 12px;
      margin-bottom: 14px;
      font-size: 11px;
      color: #666;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .result-info .info-label { color: #888; }
    .result-info .info-value { color: #00ccff; }

    .result-boxes {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .result-box {
      background: #111;
      border-radius: 8px;
      padding: 14px 16px;
      min-height: 80px;
    }

    .result-box-original {
      border-left: 3px solid #555;
    }

    .result-box-transformed {
      border-left: 3px solid #00ccff;
    }

    .result-box-label {
      font-size: 12px;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .result-box-original .result-box-label { color: #888; }
    .result-box-transformed .result-box-label { color: #00ccff; }

    .result-box-content {
      font-size: 13px;
      line-height: 1.7;
      word-break: break-word;
      white-space: pre-wrap;
    }

    .result-box-original .result-box-content { color: #999; }

    .result-box-transformed .result-box-content {
      color: #e0e0e0;
      background: rgba(0, 204, 255, 0.03);
      padding: 8px;
      border-radius: 4px;
    }

    /* Unsupported message */
    .result-unsupported {
      background: #1a1111;
      border: 1px solid #441111;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      color: #ff6644;
      font-size: 13px;
      line-height: 1.8;
    }

    .result-unsupported .supported-list {
      color: #888;
      font-size: 11px;
      margin-top: 8px;
    }

    .result-unsupported .supported-list span { color: #666; }

    /* Action buttons row */
    .result-actions {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }

    .action-btn {
      flex: 1;
      padding: 10px;
      background: #111;
      border: 1px solid #333;
      border-radius: 6px;
      color: #888;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .action-btn:hover {
      border-color: #00ccff;
      color: #00ccff;
      background: #0a1a22;
    }

    .action-btn.copied {
      border-color: #00ff00;
      color: #00ff00;
      background: #002200;
    }

    /* === Status Bar === */
    .status-bar {
      background: #1a1a1a;
      padding: 6px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid #333;
      font-size: 11px;
      flex-shrink: 0;
    }

    .status-bar .left { color: #00ccff; }
    .status-bar .right { color: #666; display: flex; gap: 4px; align-items: center; }
    .status-bar .sep { color: #333; margin: 0 4px; }
    .status-bar a {
      color: #666;
      text-decoration: none;
      transition: color 0.2s;
    }
    .status-bar a:hover { color: #00ccff; }

    /* === Responsive === */
    @media (max-width: 700px) {
      .nav-link { font-size: 11px; padding: 8px 10px; }

      .terminal-body { padding: 16px 12px; }

      .role-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .tone-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .result-boxes {
        grid-template-columns: 1fr;
      }

      .setup-title { font-size: 18px; }
      .setup-header .logo-emoji { font-size: 36px; }

      .status-bar {
        flex-direction: column;
        gap: 4px;
        align-items: flex-start;
      }
    }

    @media (max-width: 400px) {
      .role-grid {
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .tone-grid {
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .result-actions {
        flex-direction: column;
      }
    }
  </style>
  <!-- Vercel Web Analytics -->
  <script>window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };</script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body>

  <!-- Navigation Bar -->
  <nav class="nav-bar">
    <a class="nav-link" href="index.html">é¦–é¡µ</a>
    <a class="nav-link" href="jargon.html">é»‘è¯ç”Ÿæˆ</a>
    <a class="nav-link" href="weekly.html">å‘¨æŠ¥ç”Ÿæˆ</a>
    <a class="nav-link active" href="email.html">é‚®ä»¶è½¬æ¢</a>
    <a class="nav-link" href="meeting-suggest.html">ä¼šè®®å‘è¨€</a>
    <a class="nav-link" href="meeting.html">ä¼šè®®å®¤</a>
    <a class="nav-link" href="interview.html">å‹åŠ›é¢è¯•</a>
  </nav>

  <div class="terminal">
    <!-- Terminal Header -->
    <div class="terminal-header">
      <div class="terminal-buttons">
        <div class="terminal-btn close"></div>
        <div class="terminal-btn minimize"></div>
        <div class="terminal-btn maximize"></div>
      </div>
      <div class="terminal-title">email-tone-converter -- pua-cli</div>
    </div>

    <!-- Terminal Body -->
    <div class="terminal-body">
      <div class="setup-view">

        <!-- Header -->
        <div class="setup-header">
          <span class="logo-emoji">ğŸ“§</span>
          <div class="setup-title">é‚®ä»¶è¯­æ°”è½¬æ¢å™¨</div>
          <div class="setup-subtitle">ä¸€é”®è½¬æ¢èŒåœºé‚®ä»¶çš„è¯­æ°”å’Œé£æ ¼</div>
        </div>

        <!-- From Role Selection -->
        <div class="setup-section">
          <div class="section-label">
            å‘é€è€…è§’è‰² (From)
            <span class="badge badge-from">FROM</span>
          </div>
          <div class="role-grid" id="fromGrid">
            <div class="role-card" data-role="boss">
              <span class="emoji">ğŸ‘”</span>
              <div class="name">Boss</div>
              <div class="desc">è€æ¿/æ€»ç›‘</div>
            </div>
            <div class="role-card" data-role="employee">
              <span class="emoji">ğŸ˜“</span>
              <div class="name">Employee</div>
              <div class="desc">æ™®é€šå‘˜å·¥</div>
            </div>
            <div class="role-card" data-role="pm">
              <span class="emoji">ğŸ“‹</span>
              <div class="name">PM</div>
              <div class="desc">äº§å“ç»ç†</div>
            </div>
            <div class="role-card" data-role="hr">
              <span class="emoji">ğŸ’¼</span>
              <div class="name">HR</div>
              <div class="desc">äººåŠ›èµ„æº</div>
            </div>
            <div class="role-card" data-role="techlead">
              <span class="emoji">ğŸ‘¨â€ğŸ’»</span>
              <div class="name">TechLead</div>
              <div class="desc">æŠ€æœ¯ä¸»ç®¡</div>
            </div>
            <div class="role-card" data-role="intern">
              <span class="emoji">ğŸŒ±</span>
              <div class="name">Intern</div>
              <div class="desc">å®ä¹ ç”Ÿ</div>
            </div>
          </div>
        </div>

        <!-- Direction Display -->
        <div class="direction-display" id="directionDisplay">
          <span style="color:#444;">è¯·é€‰æ‹©å‘é€è€…å’Œæ¥æ”¶è€…</span>
        </div>

        <!-- To Role Selection -->
        <div class="setup-section">
          <div class="section-label">
            æ¥æ”¶è€…è§’è‰² (To)
            <span class="badge badge-to">TO</span>
          </div>
          <div class="role-grid" id="toGrid">
            <div class="role-card" data-role="boss">
              <span class="emoji">ğŸ‘”</span>
              <div class="name">Boss</div>
              <div class="desc">è€æ¿/æ€»ç›‘</div>
            </div>
            <div class="role-card" data-role="employee">
              <span class="emoji">ğŸ˜“</span>
              <div class="name">Employee</div>
              <div class="desc">æ™®é€šå‘˜å·¥</div>
            </div>
            <div class="role-card" data-role="pm">
              <span class="emoji">ğŸ“‹</span>
              <div class="name">PM</div>
              <div class="desc">äº§å“ç»ç†</div>
            </div>
            <div class="role-card" data-role="hr">
              <span class="emoji">ğŸ’¼</span>
              <div class="name">HR</div>
              <div class="desc">äººåŠ›èµ„æº</div>
            </div>
            <div class="role-card" data-role="techlead">
              <span class="emoji">ğŸ‘¨â€ğŸ’»</span>
              <div class="name">TechLead</div>
              <div class="desc">æŠ€æœ¯ä¸»ç®¡</div>
            </div>
            <div class="role-card" data-role="intern">
              <span class="emoji">ğŸŒ±</span>
              <div class="name">Intern</div>
              <div class="desc">å®ä¹ ç”Ÿ</div>
            </div>
          </div>
        </div>

        <!-- Tone Selection -->
        <div class="setup-section">
          <div class="section-label">è¯­æ°” (Tone)</div>
          <div class="tone-grid" id="toneGrid">
            <div class="tone-card selected" data-tone="polite">
              <span class="emoji">ğŸ©</span>
              <div class="name">ç¤¼è²Œ</div>
              <div class="desc">æ­£å¼å•†åŠ¡</div>
            </div>
            <div class="tone-card" data-tone="urgent">
              <span class="emoji">ğŸ”¥</span>
              <div class="name">ç´§æ€¥</div>
              <div class="desc">å‚¬ä¿ƒæ–½å‹</div>
            </div>
            <div class="tone-card" data-tone="casual">
              <span class="emoji">ğŸ˜</span>
              <div class="name">éšæ„</div>
              <div class="desc">è½»æ¾è‡ªåœ¨</div>
            </div>
            <div class="tone-card" data-tone="passive">
              <span class="emoji">ğŸŒŠ</span>
              <div class="name">å§”å©‰</div>
              <div class="desc">å«è“„è¡¨è¾¾</div>
            </div>
          </div>
        </div>

        <!-- Content Input -->
        <div class="setup-section">
          <div class="section-label">é‚®ä»¶å†…å®¹ (Content)</div>
          <textarea class="content-area" id="contentInput"
            placeholder="è¾“å…¥ä½ çš„é‚®ä»¶å†…å®¹..."
            maxlength="500"
            rows="4"></textarea>
        </div>

        <!-- Convert Button -->
        <button class="convert-btn" id="convertBtn" disabled>è½¬æ¢è¯­æ°”</button>

        <!-- Result Area -->
        <div class="result-area" id="resultArea">
          <div class="result-header">
            <div class="result-header-title">è½¬æ¢ç»“æœ</div>
          </div>

          <!-- Conversion Info -->
          <div class="result-info" id="resultInfo"></div>

          <!-- Result Content (two-column or unsupported message) -->
          <div id="resultContent"></div>

          <!-- Actions -->
          <div class="result-actions" id="resultActions" style="display:none;">
            <button class="action-btn" id="copyBtn">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
            <button class="action-btn" id="regenerateBtn">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="left">
        <span>ğŸ“§ é‚®ä»¶è¯­æ°”è½¬æ¢å™¨</span>
      </div>
      <div class="right">
        <a href="index.html">é¦–é¡µ</a>
        <span class="sep">|</span>
        <a href="jargon.html">é»‘è¯</a>
        <span class="sep">|</span>
        <a href="weekly.html">å‘¨æŠ¥</a>
        <span class="sep">|</span>
        <a href="meeting-suggest.html">å‘è¨€</a>
        <span class="sep">|</span>
        <a href="meeting.html">ä¼šè®®å®¤</a>
        <span class="sep">|</span>
        <a href="interview.html">é¢è¯•</a>
        <span class="sep">|</span>
        <a href="https://github.com/ava-agent/pua-cli" target="_blank" rel="noopener">GitHub</a>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // Data: Role & Tone Info
    // ============================================

    // Role display info
    var ROLE_INFO = {
      boss:     { name: 'è€æ¿', emoji: 'ğŸ‘”' },
      employee: { name: 'å‘˜å·¥', emoji: 'ğŸ˜“' },
      pm:       { name: 'äº§å“ç»ç†', emoji: 'ğŸ“‹' },
      hr:       { name: 'HR', emoji: 'ğŸ’¼' },
      techlead: { name: 'æŠ€æœ¯ä¸»ç®¡', emoji: 'ğŸ‘¨â€ğŸ’»' },
      intern:   { name: 'å®ä¹ ç”Ÿ', emoji: 'ğŸŒ±' }
    };

    var TONE_INFO = {
      polite:  { name: 'ç¤¼è²Œ', desc: 'æ­£å¼å•†åŠ¡' },
      urgent:  { name: 'ç´§æ€¥', desc: 'å‚¬ä¿ƒæ–½å‹' },
      casual:  { name: 'éšæ„', desc: 'è½»æ¾è‡ªåœ¨' },
      passive: { name: 'å§”å©‰', desc: 'å«è“„è¡¨è¾¾' }
    };

    // Role aliases (dev/developer/team -> employee, manager -> pm, lead -> techlead)
    var ROLE_ALIASES = {
      dev: 'employee',
      developer: 'employee',
      team: 'employee',
      manager: 'pm',
      lead: 'techlead'
    };

    // Direction labels
    var DIRECTION_LABELS = {
      upward: 'å‘ä¸Šçº§',
      downward: 'å‘ä¸‹çº§',
      cross: 'å¹³çº§åŒäº‹',
      external: 'å¯¹å¤–å•†åŠ¡'
    };

    // ============================================
    // State
    // ============================================

    var selectedFrom = null;
    var selectedTo = null;
    var selectedTone = 'polite';
    var lastResult = null;
    var isConverting = false;

    // ============================================
    // DOM Elements
    // ============================================

    var fromGrid = document.getElementById('fromGrid');
    var toGrid = document.getElementById('toGrid');
    var toneGrid = document.getElementById('toneGrid');
    var contentInput = document.getElementById('contentInput');
    var convertBtn = document.getElementById('convertBtn');
    var resultArea = document.getElementById('resultArea');
    var resultInfo = document.getElementById('resultInfo');
    var resultContent = document.getElementById('resultContent');
    var resultActions = document.getElementById('resultActions');
    var copyBtn = document.getElementById('copyBtn');
    var regenerateBtn = document.getElementById('regenerateBtn');
    var directionDisplay = document.getElementById('directionDisplay');

    // ============================================
    // Utility
    // ============================================

    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function deriveDirection(from, to) {
      var hierarchy = { boss: 4, techlead: 4, pm: 3, hr: 3, employee: 2, intern: 1 };
      var fromLevel = hierarchy[from] || 2;
      var toLevel = hierarchy[to] || 2;
      if (fromLevel < toLevel) return 'upward';
      if (fromLevel > toLevel) return 'downward';
      return 'cross';
    }

    // ============================================
    // UI Updates
    // ============================================

    function updateDirectionDisplay() {
      if (!selectedFrom && !selectedTo) {
        directionDisplay.innerHTML = '<span style="color:#444;">è¯·é€‰æ‹©å‘é€è€…å’Œæ¥æ”¶è€…</span>';
        return;
      }

      var html = '';

      if (selectedFrom) {
        var fromInfo = ROLE_INFO[selectedFrom];
        html += '<span class="from-name">' + fromInfo.emoji + ' ' + fromInfo.name + '</span>';
      } else {
        html += '<span style="color:#444;">???</span>';
      }

      html += '<span class="arrow"> â†’ </span>';

      if (selectedTo) {
        var toInfo = ROLE_INFO[selectedTo];
        html += '<span class="to-name">' + toInfo.emoji + ' ' + toInfo.name + '</span>';
      } else {
        html += '<span style="color:#444;">???</span>';
      }

      if (selectedFrom && selectedTo) {
        var direction = deriveDirection(selectedFrom, selectedTo);
        var dirLabel = DIRECTION_LABELS[direction] || direction;
        html += ' <span style="color:#00ccff;font-size:10px;margin-left:8px;">(' + dirLabel + ')</span>';
      }

      directionDisplay.innerHTML = html;
    }

    function updateConvertButton() {
      var hasContent = contentInput.value.trim().length > 0;
      var hasFrom = selectedFrom !== null;
      var hasTo = selectedTo !== null;
      convertBtn.disabled = !(hasContent && hasFrom && hasTo) || isConverting;
    }

    function showResult(originalContent, transformedText, from, to, tone) {
      var fromInfo = ROLE_INFO[from] || { name: from, emoji: '' };
      var toInfo = ROLE_INFO[to] || { name: to, emoji: '' };
      var toneInfo = TONE_INFO[tone] || { name: tone, desc: '' };
      var direction = deriveDirection(from, to);
      var dirLabel = DIRECTION_LABELS[direction] || direction;

      lastResult = {
        content: originalContent,
        from: from,
        to: to,
        tone: tone,
        transformed: transformedText
      };

      // Show info bar
      resultInfo.innerHTML =
        '<span><span class="info-label">æ–¹å‘: </span><span class="info-value">' +
        fromInfo.emoji + ' ' + fromInfo.name + ' â†’ ' + toInfo.emoji + ' ' + toInfo.name +
        ' (' + dirLabel + ')' +
        '</span></span>' +
        '<span><span class="info-label">è¯­æ°”: </span><span class="info-value">' +
        toneInfo.name + ' (' + toneInfo.desc + ')' +
        '</span></span>';

      resultContent.innerHTML =
        '<div class="result-boxes">' +
          '<div class="result-box result-box-original">' +
            '<div class="result-box-label">ğŸ“ åŸæ–‡</div>' +
            '<div class="result-box-content">' + escapeHtml(originalContent) + '</div>' +
          '</div>' +
          '<div class="result-box result-box-transformed">' +
            '<div class="result-box-label">âœ¨ AI è½¬æ¢</div>' +
            '<div class="result-box-content">' + escapeHtml(transformedText) + '</div>' +
          '</div>' +
        '</div>';
      resultActions.style.display = 'flex';

      resultArea.classList.add('visible');

      // Scroll result into view
      requestAnimationFrame(function() {
        resultArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      });
    }

    function showError(message) {
      resultInfo.innerHTML = '';
      resultContent.innerHTML =
        '<div class="result-unsupported">' +
          escapeHtml(message) +
        '</div>';
      resultActions.style.display = 'none';
      resultArea.classList.add('visible');

      requestAnimationFrame(function() {
        resultArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      });
    }

    // ============================================
    // API Call
    // ============================================

    function convertEmail() {
      var content = contentInput.value.trim();
      if (!content || !selectedFrom || !selectedTo) return;

      var direction = deriveDirection(selectedFrom, selectedTo);

      // Set loading state
      isConverting = true;
      convertBtn.disabled = true;
      convertBtn.textContent = 'è½¬æ¢ä¸­...';
      resultArea.classList.remove('visible');

      fetch('/api/email-transform', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          content: content,
          direction: direction,
          role: selectedFrom
        })
      })
      .then(function(response) {
        if (!response.ok) {
          throw new Error('æœåŠ¡è¯·æ±‚å¤±è´¥ (' + response.status + ')');
        }
        return response.json();
      })
      .then(function(data) {
        if (data && data.result) {
          showResult(content, data.result, selectedFrom, selectedTo, selectedTone);
        } else {
          showError('æœåŠ¡è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•');
        }
      })
      .catch(function(err) {
        showError('è½¬æ¢å¤±è´¥: ' + (err.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥åé‡è¯•'));
      })
      .finally(function() {
        isConverting = false;
        convertBtn.textContent = 'è½¬æ¢è¯­æ°”';
        updateConvertButton();
      });
    }

    // ============================================
    // Event Handlers
    // ============================================

    // From role selection
    fromGrid.addEventListener('click', function(e) {
      var card = e.target.closest('.role-card');
      if (!card) return;

      var role = card.dataset.role;

      // Deselect if clicking same card
      if (selectedFrom === role) {
        card.classList.remove('from-selected');
        selectedFrom = null;
      } else {
        // Clear previous selection
        fromGrid.querySelectorAll('.role-card').forEach(function(c) {
          c.classList.remove('from-selected');
        });
        card.classList.add('from-selected');
        selectedFrom = role;
      }

      updateDirectionDisplay();
      updateConvertButton();
    });

    // To role selection
    toGrid.addEventListener('click', function(e) {
      var card = e.target.closest('.role-card');
      if (!card) return;

      var role = card.dataset.role;

      if (selectedTo === role) {
        card.classList.remove('to-selected');
        selectedTo = null;
      } else {
        toGrid.querySelectorAll('.role-card').forEach(function(c) {
          c.classList.remove('to-selected');
        });
        card.classList.add('to-selected');
        selectedTo = role;
      }

      updateDirectionDisplay();
      updateConvertButton();
    });

    // Tone selection
    toneGrid.addEventListener('click', function(e) {
      var card = e.target.closest('.tone-card');
      if (!card) return;

      toneGrid.querySelectorAll('.tone-card').forEach(function(c) {
        c.classList.remove('selected');
      });
      card.classList.add('selected');
      selectedTone = card.dataset.tone;
    });

    // Content input
    contentInput.addEventListener('input', function() {
      updateConvertButton();
    });

    // Convert button
    convertBtn.addEventListener('click', function() {
      if (isConverting) return;
      convertEmail();
    });

    // Allow Ctrl+Enter to submit
    contentInput.addEventListener('keydown', function(e) {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        if (!convertBtn.disabled && !isConverting) {
          convertEmail();
        }
      }
    });

    // Copy button
    copyBtn.addEventListener('click', function() {
      if (!lastResult || !lastResult.transformed) return;

      var text = lastResult.transformed;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function() {
          showCopied();
        }).catch(function() {
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    });

    function fallbackCopy(text) {
      var ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      try {
        document.execCommand('copy');
        showCopied();
      } catch (err) {
        // Silently fail
      }
      document.body.removeChild(ta);
    }

    function showCopied() {
      copyBtn.classList.add('copied');
      copyBtn.textContent = 'âœ“ å·²å¤åˆ¶';
      setTimeout(function() {
        copyBtn.classList.remove('copied');
        copyBtn.textContent = 'ğŸ“‹ å¤åˆ¶ç»“æœ';
      }, 2000);
    }

    // Regenerate button
    regenerateBtn.addEventListener('click', function() {
      if (!lastResult || isConverting) return;
      convertEmail();
    });

  </script>
</body>
</html>
